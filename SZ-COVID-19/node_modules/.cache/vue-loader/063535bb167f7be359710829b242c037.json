{"remainingRequest":"/home/yujiahao/Downloads/visual_work/SZ-COVID-19/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/yujiahao/Downloads/visual_work/SZ-COVID-19/src/page/ranking/components/map.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/yujiahao/Downloads/visual_work/SZ-COVID-19/src/page/ranking/components/map.vue","mtime":1618628490000},{"path":"/home/yujiahao/Downloads/visual_work/SZ-COVID-19/node_modules/cache-loader/dist/cjs.js","mtime":1617788517390},{"path":"/home/yujiahao/Downloads/visual_work/SZ-COVID-19/node_modules/babel-loader/lib/index.js","mtime":1617788517170},{"path":"/home/yujiahao/Downloads/visual_work/SZ-COVID-19/node_modules/cache-loader/dist/cjs.js","mtime":1617788517390},{"path":"/home/yujiahao/Downloads/visual_work/SZ-COVID-19/node_modules/vue-loader/lib/index.js","mtime":1617788568833}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBldmVudEJ1cyBmcm9tICcuLi9ldmVudEJ1cyc7CmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7CmltcG9ydCB7IGV4dGVudCB9IGZyb20gJ2QzJwppbXBvcnQgZWNoYXJ0cyBmcm9tICdlY2hhcnRzL2xpYi9lY2hhcnRzJzsKaW1wb3J0ICdlY2hhcnRzL2xpYi9jb21wb25lbnQvZ2VvJwppbXBvcnQgJ2VjaGFydHMvbWFwL2pzL3dvcmxkLmpzJzsKaW1wb3J0IFN0YXRpb25HZW8gZnJvbSAnQC9kYXRhL3N0YXRpb24nCmltcG9ydCBUcmFja0pTT04gZnJvbSAnQC9kYXRhL3RyYWNrJwppbXBvcnQgQ291bnRyeU1hcHBpbmdKU09OIGZyb20gJ0AvZGF0YS9jb3VudHJ5TWFwcGluZycKaW1wb3J0IENvdW50cnlJMThuIGZyb20gJ0AvZGF0YS9jb3VudHJ5STE4bicKCmNvbnN0IFBFUklPRCA9IDI7Cgpjb25zdCBERUZBVUxUX0NFTlRFUiA9IFsxMTQuMjc5LCAzMF0KCmNvbnN0IERFRkFVTFRfWk9PTSA9IDkKCmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICdNYXAnLAogICAgZGF0YSgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBpc0FsbDogdHJ1ZSwKICAgICAgICAgICAgY3VycmVudERhdGU6ICcnLAogICAgICAgIH0KICAgIH0sCiAgICBtZXRob2RzOiB7CiAgICAgICAgaW5pdE1hcCgpIHsKICAgICAgICAgICAgY29uc3Qgc2VyaWVzID0gdGhpcy5pbml0U2VyaWVzKCk7CiAgICAgICAgICAgIGNvbnN0IHtvcHRpb25zLCB0aW1lbGluZURhdGF9ID0gdGhpcy5pbml0T3B0aW9ucygpCiAgICAgICAgICAgIHZhciBvcHRpb24gPSB7CiAgICAgICAgICAgICAgICBiYXNlT3B0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgdGltZWxpbmU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEluZGV4OiB0aGlzLnRpbWVsaW5lSW5kZXggfHwgMCwKICAgICAgICAgICAgICAgICAgICAgICAgb3JpZW50OiAndmVydGljYWwnLAogICAgICAgICAgICAgICAgICAgICAgICB0b3A6ICcyMCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6ICc5MCUnLAogICAgICAgICAgICAgICAgICAgICAgICByaWdodDogJzIwJywKICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tOiAnMTAnLAogICAgICAgICAgICAgICAgICAgICAgICBheGlzVHlwZTogJ2NhdGVnb3J5JywKICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sOiAncmVjdCcsCiAgICAgICAgICAgICAgICAgICAgICAgIHN5bWJvbFNpemU6IFsxMCwgNl0sCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1TdHlsZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjMTUyYTY4JywKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2twb2ludFN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeW1ib2w6ICdyb3VuZFJlY3QnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjM2M4YWYxJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5bWJvbFNpemU6IFsxMCwgNl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbFN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtU2l6ZTogMTUsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGVtcGhhc2lzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtU3R5bGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJyMzYzhhZjEnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjM2M4YWYxJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sU3R5bGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJyMzYzhhZjEnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiAnM2M4YWYxJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogMTAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbDogMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnI2FhYScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb250U2l6ZTogMTAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZXI6IHZhbHVlID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUodmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtkYXRlLmdldEZ1bGxZZWFyKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGUuZ2V0TW9udGgoKSArIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGUuZ2V0RGF0ZSgpXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmpvaW4oJy0nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBsb29wOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBhdXRvUGxheTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgcGxheUludGVydmFsOiBQRVJJT0QgKiAxMDAwLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aW1lbGluZURhdGEKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHRvb2x0aXA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogJ2l0ZW0nLAogICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICdyZ2JhKDE2NiwgMjAwLCA3NiwgMC44MiknLAogICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogJyNGRkZGQ0MnLAogICAgICAgICAgICAgICAgICAgICAgICBzaG93RGVsYXk6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGhpZGVEZWxheTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgZW50ZXJhYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uRHVyYXRpb246IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhQ3NzVGV4dDogJ3otaW5kZXg6MTAwJywKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHZpc3VhbE1hcDogWwogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdoZWF0bWFwJywKICAgICAgICAgICAgICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWVzSW5kZXg6IDUsCiAgICAgICAgICAgICAgICAgICAgICAgIG1pbjogMCwKICAgICAgICAgICAgICAgICAgICAgICAgbWF4OiAxMDAwMCwKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogMTAsCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1HYXA6IDQsCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1TeW1ib2w6ICdjaXJjbGUnLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0U3R5bGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnI2FhYScsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHBpZWNlczogW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGd0OiAxMDAwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAiPiAxMDAwMCDkuroiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICJyZ2JhKDU3LCAxMTEsIDI1NSkiCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGd0ZTogNTAwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGx0ZTogMTAwMDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIjUwMDAgLSAxMDAwMCDkuroiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICJyZ2JhKDUwLCA5NywgMjIyKSIKICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3RlOiAyMDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsdDogNTAwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAiMjAwIC0gNTAwMCDkuroiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICJyZ2JhKDQyLCA4MiwgMTg5KSIKICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3Q6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsdDogMjAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICIwIC0gMjAw5Lq6IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAicmdiYSgzNSwgNjgsIDE1NikiCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICJyZ2JhKDUxLCA2OSwgODksIC41KSIKICAgICAgICAgICAgICAgICAgICAgICAgfV0sCiAgICAgICAgICAgICAgICAgICAgfV0sCiAgICAgICAgICAgICAgICAgICAgZ2VvOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hcDogJ3dvcmxkJywKICAgICAgICAgICAgICAgICAgICAgICAgem9vbTogREVGQVVMVF9aT09NLAogICAgICAgICAgICAgICAgICAgICAgICBjZW50ZXI6IERFRkFVTFRfQ0VOVEVSLAogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1waGFzaXM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93OiBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBzY2FsZUxpbWl0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW46IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXg6IDEyCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHJvYW06IHRydWUsIC8v5piv5ZCm5YWB6K6457yp5pS+CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1TdHlsZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9ybWFsOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICdyZ2JhKDUxLCA2OSwgODksIC41KScsIC8v5Zyw5Zu+6IOM5pmv6ImyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6ICcjNTE2YTg5JywgLy/nnIHluILovrnnlYznur8wMGZjZmYgNTE2YTg5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbXBoYXNpczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAncmdiYSg1MSwgNjksIDg5LCAuNSknIC8v5oKs5rWu6IOM5pmvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNlcmllczogc2VyaWVzCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb3B0aW9ucywKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5teUNoYXJ0LnNldE9wdGlvbihvcHRpb24sIHRydWUpOwogICAgICAgIH0sCiAgICAgICAgaW5pdEhlYXREYXRhKCkgewogICAgICAgICAgICByZXR1cm4gZmV0Y2goJ2QvZm9ybWF0X3RpbWVzZXJpZXMuanNvbicpCiAgICAgICAgICAgICAgICAudGhlbihyZXMgPT4gcmVzLmpzb24oKSkKICAgICAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oZWF0RGF0YSA9IF8ucGlja0J5KHJlcywgKGQsIGspID0+IENvdW50cnlNYXBwaW5nSlNPTltrXSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBpbml0RGF0YSgpIHsKICAgICAgICAgICAgY29uc3QgdHJhY2tPYmogPSBfLmNoYWluKFRyYWNrSlNPTikKICAgICAgICAgICAgICAgIC5maWx0ZXIoZCA9PiBkLnRyYWNrLmxlbmd0aCA+IDApCiAgICAgICAgICAgICAgICAubWFwKGQgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgdHJhY2ssIGJsaCB9ID0gZDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydHN0YXRpb24gPSB0cmFja1swXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBlbmRzdGF0aW9uID0gdHJhY2tbdHJhY2subGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhY2tJdGVtID0gW3sKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogc3RhcnRzdGF0aW9uLmZyb20sCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IHN0YXJ0c3RhdGlvbi50aW1lLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogMSwKICAgICAgICAgICAgICAgICAgICAgICAgY29vcmQ6IFN0YXRpb25HZW9bc3RhcnRzdGF0aW9uLmZyb21dLAogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogZW5kc3RhdGlvbi50bywKICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogZW5kc3RhdGlvbi50aW1lLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogMSwKICAgICAgICAgICAgICAgICAgICAgICAgY29vcmQ6IFN0YXRpb25HZW9bZW5kc3RhdGlvbi50b10sCiAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBibGgsCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNrOiB0cmFja0l0ZW0sCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5yZWR1Y2UoKG8sIGQpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBkLnRyYWNrWzFdLnRpbWUKICAgICAgICAgICAgICAgICAgICBpZiAob1trZXldKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9ba2V5XS5wdXNoKGQpCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgb1trZXldID0gW2RdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBvCiAgICAgICAgICAgICAgICB9LCB7fSkKICAgICAgICAgICAgICAgIC5waWNrQnkoJ2xlbmd0aCcpCiAgICAgICAgICAgICAgICAudmFsdWUoKQogICAgICAgICAgICByZXR1cm4gdHJhY2tPYmo7CiAgICAgICAgfSwKICAgICAgICBnZXRTY2F0dGVyRGF0YShkYXRhKSB7CiAgICAgICAgICAgIHJldHVybiBfLmNoYWluKGRhdGEpCiAgICAgICAgICAgICAgICAuZmxhdHRlbkRlZXAoKQogICAgICAgICAgICAgICAgLnJlZHVjZSgob2JqLCBkKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYoZC5uYW1lID09PSAn5rex5ZyzJykgcmV0dXJuIG9iajsKICAgICAgICAgICAgICAgICAgICBpZiAoIW9ialtkLm5hbWVdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtkLm5hbWVdID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogZC5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGQuY29vcmQuY29uY2F0KDApLAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG9ialtkLm5hbWVdLnZhbHVlWzJdICs9IDEKICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAgICAgICAgICAgfSwge30pCiAgICAgICAgICAgICAgICAudmFsdWVzKCkKICAgICAgICAgICAgICAgIC52YWx1ZSgpOwogICAgICAgIH0sCiAgICAgICAgZ2V0SGVhdERhdGEoZGF0ZSkgewogICAgICAgICAgICByZXR1cm4gXy5jaGFpbih0aGlzLmhlYXREYXRhKQogICAgICAgICAgICAgICAgLm1hcCgoYXJyLCBrKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmluZEl0ZW0gPSBhcnIuZmluZChkMSA9PiBkMS5kYXRlID09PSBkYXRlKSB8fCB7fQogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IENvdW50cnlNYXBwaW5nSlNPTltrXSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGZpbmRJdGVtLmV4aXN0IHx8IDAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLnZhbHVlKCkKICAgICAgICB9LAogICAgICAgIGluaXRPcHRpb25zKCkgewogICAgICAgICAgICBjb25zdCB0aW1lVHJhY2sgPSB0aGlzLmluaXREYXRhKCkKICAgICAgICAgICAgdGhpcy50aW1lVHJhY2sgPSB0aW1lVHJhY2sKICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IF8uY2hhaW4odGltZVRyYWNrKQogICAgICAgICAgICAgICAgLm9yZGVyQnkoZCA9PiBuZXcgRGF0ZShkWzBdLnRyYWNrWzFdLnRpbWUpLmdldFRpbWUoKSkKICAgICAgICAgICAgICAgIC5tYXAoKGQsIGksIGFycikgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYWNrRGF0YSA9IGQubWFwKGQxID0+IGQxLnRyYWNrKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFkZFRyYWNrRGF0YSA9IHRoaXMuaXNBbGwKICAgICAgICAgICAgICAgICAgICA/IF8uY2hhaW4oYXJyKQogICAgICAgICAgICAgICAgICAgICAgICAuc2xpY2UoMCwgaSArIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIC5mbGF0dGVuKCkKICAgICAgICAgICAgICAgICAgICAgICAgLm1hcChkMSA9PiBkMS50cmFjaykKICAgICAgICAgICAgICAgICAgICAgICAgLnZhbHVlKCkKICAgICAgICAgICAgICAgICAgICA6IFtdCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2NhdHRlckRhdGEgPSB0aGlzLmdldFNjYXR0ZXJEYXRhKHRyYWNrRGF0YSkKICAgICAgICAgICAgICAgICAgICBjb25zdCBhZGRTY2F0dGVyRGF0YSA9IHRoaXMuZ2V0U2NhdHRlckRhdGEoYWRkVHJhY2tEYXRhKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0RhdGUgPSBuZXcgRGF0ZShkWzBdLnRyYWNrWzFdLnRpbWUpCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudERhdGUgPSBgJHtuZXdEYXRlLmdldEZ1bGxZZWFyKCl9LSR7CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0RhdGUuZ2V0TW9udGgoKSArIDF9LSR7bmV3RGF0ZS5nZXREYXRlKCl9YAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGhlYXREYXRhID0gdGhpcy5nZXRIZWF0RGF0YShjdXJyZW50RGF0ZSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBzZXJpZXM6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB0cmFja0RhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHNjYXR0ZXJEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBhZGRUcmFja0RhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGFkZFNjYXR0ZXJEYXRhCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHt9LAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBoZWF0RGF0YQogICAgICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAudmFsdWUoKQoKICAgICAgICAgICAgY29uc3QgdGltZWxpbmVEYXRhID0gXy5jaGFpbih0aW1lVHJhY2spCiAgICAgICAgICAgICAgICAua2V5cygpCiAgICAgICAgICAgICAgICAub3JkZXJCeShkID0+IG5ldyBEYXRlKGQpLmdldFRpbWUoKSkKICAgICAgICAgICAgICAgIC52YWx1ZSgpCiAgICAgICAgICAgIHJldHVybiB7b3B0aW9ucywgdGltZWxpbmVEYXRhfQogICAgICAgIH0sCiAgICAgICAgY2FsY3VsYXRlUmFkaXVzKGQpIHsKICAgICAgICAgICAgaWYoZFsyXSA+PSAxMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIDEwCiAgICAgICAgICAgIH0gZWxzZSBpZihkWzJdPD00KXsKICAgICAgICAgICAgICAgIHJldHVybiA0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBkWzJdIAogICAgICAgIH0sCiAgICAgICAgaW5pdFNlcmllcygpIHsKICAgICAgICAgICAgY29uc3Qgc2VyaWVzID0gW107CiAgICAgICAgICAgIHNlcmllcy5wdXNoKAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJsaW5lcyIsCiAgICAgICAgICAgICAgICAgICAgemxldmVsOiAyLAogICAgICAgICAgICAgICAgICAgIGVmZmVjdDogewogICAgICAgICAgICAgICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBwZXJpb2Q6IFBFUklPRCAtIC41LCAvL+eureWktOaMh+WQkemAn+W6pu+8jOWAvOi2iuWwj+mAn+W6pui2iuW/qwogICAgICAgICAgICAgICAgICAgICAgICB0cmFpbExlbmd0aDogMC4wMiwgLy/nibnmlYjlsL7ov7nplb/luqZbMCwxXeWAvOi2iuWkp++8jOWwvui/uei2iumVv+mHjQogICAgICAgICAgICAgICAgICAgICAgICBzeW1ib2w6ICJhcnJvdyIsIC8v566t5aS05Zu+5qCHCiAgICAgICAgICAgICAgICAgICAgICAgIHN5bWJvbFNpemU6IDUsIC8v5Zu+5qCH5aSn5bCPCiAgICAgICAgICAgICAgICAgICAgICAgIGxvb3A6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgbGluZVN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxLCAvL+Wwvui/uee6v+adoeWuveW6pgogICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjQsIC8v5bC+6L+557q/5p2h6YCP5piO5bqmCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnZlbmVzczogMC4zLCAvL+Wwvui/uee6v+adoeabsuebtOW6pgogICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJyNmZTczMzUnLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlZmZlY3RTY2F0dGVyJywKICAgICAgICAgICAgICAgICAgICBjb29yZGluYXRlU3lzdGVtOiAnZ2VvJywKICAgICAgICAgICAgICAgICAgICB6bGV2ZWw6IDEsCiAgICAgICAgICAgICAgICAgICAgcmlwcGxlRWZmZWN0OiB7IC8v5raf5ryq54m55pWICiAgICAgICAgICAgICAgICAgICAgICAgIHBlcmlvZDogNCwgLy/liqjnlLvml7bpl7TvvIzlgLzotorlsI/pgJ/luqbotorlv6sKICAgICAgICAgICAgICAgICAgICAgICAgYnJ1c2hUeXBlOiAnc3Ryb2tlJywgLy/ms6Lnurnnu5jliLbmlrnlvI8gc3Ryb2tlLCBmaWxsCiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiA0IC8v5rOi57q55ZyG546v5pyA5aSn6ZmQ5Yi277yM5YC86LaK5aSn5rOi57q56LaK5aSnCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBsYWJlbDogewogICAgICAgICAgICAgICAgICAgICAgICBub3JtYWw6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ3JpZ2h0JywgLy/mmL7npLrkvY3nva4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogWzUsIDBdLCAvL+WBj+enu+iuvue9rgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVyOiBmdW5jdGlvbihwYXJhbXMpey8v5ZyG546v5pi+56S65paH5a2XCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcmFtcy5kYXRhLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udFNpemU6IDEwCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGVtcGhhc2lzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93OiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHN5bWJvbDogJ2NpcmNsZScsCiAgICAgICAgICAgICAgICAgICAgc3ltYm9sU2l6ZTogZCA9PiB0aGlzLmNhbGN1bGF0ZVJhZGl1cyhkKSwKICAgICAgICAgICAgICAgICAgICBpdGVtU3R5bGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjZmU3MzM1JywKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZDogJ2FsbExpbmVzJywKICAgICAgICAgICAgICAgICAgICB0eXBlOiAibGluZXMiLAogICAgICAgICAgICAgICAgICAgIHpsZXZlbDogMiwKICAgICAgICAgICAgICAgICAgICBsaW5lU3R5bGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjZmU3MzM1JywKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDEsIC8v5bC+6L+557q/5p2h5a695bqmCiAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuOCwgLy/lsL7ov7nnur/mnaHpgI/mmI7luqYKICAgICAgICAgICAgICAgICAgICAgICAgY3VydmVuZXNzOiAwLjMgLy/lsL7ov7nnur/mnaHmm7Lnm7TluqYKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGlkOiAnYWRkU2NhdHRlcicsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3NjYXR0ZXInLAogICAgICAgICAgICAgICAgICAgIGNvb3JkaW5hdGVTeXN0ZW06ICdnZW8nLAogICAgICAgICAgICAgICAgICAgIHpsZXZlbDogMSwKICAgICAgICAgICAgICAgICAgICBsYWJlbDogewogICAgICAgICAgICAgICAgICAgICAgICBzaG93OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHN5bWJvbDogJ2NpcmNsZScsCiAgICAgICAgICAgICAgICAgICAgc3ltYm9sU2l6ZTogZCA9PiB0aGlzLmNhbGN1bGF0ZVJhZGl1cyhkKSwKICAgICAgICAgICAgICAgICAgICBpdGVtU3R5bGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjZmU3MzM1JywKICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogLjgsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc2NhdHRlcicsCiAgICAgICAgICAgICAgICAgICAgY29vcmRpbmF0ZVN5c3RlbTogJ2dlbycsCiAgICAgICAgICAgICAgICAgICAgemxldmVsOiAyLAogICAgICAgICAgICAgICAgICAgIHJpcHBsZUVmZmVjdDogewogICAgICAgICAgICAgICAgICAgICAgICBwZXJpb2Q6IDQsCiAgICAgICAgICAgICAgICAgICAgICAgIGJydXNoVHlwZTogJ3N0cm9rZScsCiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiA0CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBsYWJlbDogewogICAgICAgICAgICAgICAgICAgICAgICBub3JtYWw6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ3JpZ2h0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vb2Zmc2V0Ols1LCAwXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnIzFjZjNlOCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZXI6ICd7Yn0nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dFN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICIjMWNmM2U4IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBlbXBoYXNpczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAiI2Y2MCIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc3ltYm9sOiAncGluJywKICAgICAgICAgICAgICAgICAgICBzeW1ib2xTaXplOiAyMCwKICAgICAgICAgICAgICAgICAgICB6OiAxMCwKICAgICAgICAgICAgICAgICAgICBkYXRhOiBbewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAn5rex5ZyzJywKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFN0YXRpb25HZW9bJ+a3seWcsyddLmNvbmNhdChbMTBdKSwKICAgICAgICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ21hcCcsCiAgICAgICAgICAgICAgICAgICAgZ2VvSW5kZXg6IDAsCiAgICAgICAgICAgICAgICAgICAgdG9vbHRpcDogewogICAgICAgICAgICAgICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZXI6ICh7ZGF0YX0pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBDb3VudHJ5STE4bltkYXRhLm5hbWVdID8gQ291bnRyeUkxOG5bZGF0YS5uYW1lXSA6IGRhdGEubmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBpc05hTihkYXRhLnZhbHVlKSB8fCAhZGF0YS52YWx1ZSA/IDAgOiBkYXRhLnZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgc3RyID0gYCR7dGhpcy5jdXJyZW50RGF0ZX08YnIvPiR7bmFtZX06ICR7dmFsdWV9ICDkvotgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGEubmFtZSkgc3RyID0gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0cgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuIHNlcmllczsKICAgICAgICB9LAogICAgICAgIGhhbmxlVGltZWxpbmVjaGFuZ2VkKCkgewogICAgICAgICAgICB0aGlzLnVwZGF0ZURhdGUoMCkKICAgICAgICAgICAgdGhpcy5teUNoYXJ0Lm9uKCd0aW1lbGluZWNoYW5nZWQnLCAoeyBjdXJyZW50SW5kZXggfSkgPT4gewogICAgICAgICAgICAgICAgdGhpcy50aW1lbGluZUluZGV4ID0gY3VycmVudEluZGV4CiAgICAgICAgICAgICAgICBjb25zdCB7IHNlcmllcyB9ID0gdGhpcy5teUNoYXJ0LmdldE9wdGlvbigpCiAgICAgICAgICAgICAgICBjb25zdCBzZXJpZXNJbmRleCA9IHRoaXMuaXNBbGwgPyAzIDogMQogICAgICAgICAgICAgICAgY29uc3QgZ2VvQXJyID0gXy5jaGFpbihzZXJpZXNbc2VyaWVzSW5kZXhdLmRhdGEpCiAgICAgICAgICAgICAgICAgICAgLm1hcChkID0+IGQudmFsdWUuc2xpY2UoMCwgMikpCiAgICAgICAgICAgICAgICAgICAgLnZhbHVlKCkKICAgICAgICAgICAgICAgIGdlb0Fyci5wdXNoKFN0YXRpb25HZW9bIua3seWcsyJdKQogICAgICAgICAgICAgICAgY29uc3QgbG5nRXh0ZW50ID0gZXh0ZW50KGdlb0FyciwgZCA9PiArZFswXSkubWFwKChkLCBpKSA9PiArZCArIChpID09PSAwID8gKC0xKSA6IDEpKQogICAgICAgICAgICAgICAgY29uc3QgbGF0RXh0ZW50ID0gZXh0ZW50KGdlb0FyciwgZCA9PiArZFsxXSkubWFwKChkLCBpKSA9PiArZCArIChpID09PSAwID8gKC0xMCkgOiAxMCkpCgogICAgICAgICAgICAgICAgY29uc3QgbG5nQ2VudGVyID0gTnVtYmVyLmlzTmFOKGxuZ0V4dGVudFswXSkgPyBERUZBVUxUX0NFTlRFUlswXSA6IChsbmdFeHRlbnRbMF0gKyBsbmdFeHRlbnRbMV0pIC8gMgogICAgICAgICAgICAgICAgY29uc3QgbGF0Q2VudGVyID0gTnVtYmVyLmlzTmFOKGxhdEV4dGVudFswXSkgPyBERUZBVUxUX0NFTlRFUlsxXSA6IChsYXRFeHRlbnRbMF0gKyBsYXRFeHRlbnRbMV0pIC8gMgogICAgICAgICAgICAgICAgY29uc3QgY2VudGVyID0gW2xuZ0NlbnRlciwgbGF0Q2VudGVyXQogICAgICAgICAgICAgICAgY29uc3Qgem9vbSA9IE51bWJlci5pc05hTihsbmdFeHRlbnRbMF0pID8gREVGQVVMVF9aT09NCiAgICAgICAgICAgICAgICAgICAgOiBfLm1pbihbMSAvICgobG5nRXh0ZW50WzFdIC0gbG5nRXh0ZW50WzBdKSAvIDM2MCksIDEgLyAoKGxhdEV4dGVudFsxXSAtIGxhdEV4dGVudFswXSkgLyAxODApXSkKCiAgICAgICAgICAgICAgICBjb25zdCBoZWF0RXh0ZW50ID0gZXh0ZW50KHNlcmllc1s1XS5kYXRhLCBkID0+IGQudmFsdWUpCiAgICAgICAgICAgICAgICB0aGlzLm15Q2hhcnQuc2V0T3B0aW9uKHsKICAgICAgICAgICAgICAgICAgICBnZW86IHsKICAgICAgICAgICAgICAgICAgICAgICAgem9vbSwKICAgICAgICAgICAgICAgICAgICAgICAgY2VudGVyLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgdmlzdWFsTWFwOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAnaGVhdG1hcCcsCiAgICAgICAgICAgICAgICAgICAgICAgIG1pbjogaGVhdEV4dGVudFswXSArIDEsCiAgICAgICAgICAgICAgICAgICAgICAgIG1heDogaGVhdEV4dGVudFsxXSArIGhlYXRFeHRlbnRbMV0gKiAuMgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2VyaWVzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAnYWxsTGluZXMnLAogICAgICAgICAgICAgICAgICAgICAgICBsaW5lU3R5bGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6ICcuMicsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgdGhpcykKCiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZURhdGUoY3VycmVudEluZGV4KQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgdXBkYXRlRGF0ZShpbmRleCkgewogICAgICAgICAgICBjb25zdCB0aW1lQXJyID0gXy5jaGFpbih0aGlzLnRpbWVUcmFjaykKICAgICAgICAgICAgICAgIC5tYXAoKGQsIGspID0+ICh7CiAgICAgICAgICAgICAgICAgICAgZGF0ZTogaywKICAgICAgICAgICAgICAgICAgICB0aW1lOiBuZXcgRGF0ZShrKS5nZXRUaW1lKCksCiAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgICAgIC5vcmRlckJ5KCd0aW1lJykKICAgICAgICAgICAgICAgIC5tYXAoJ2RhdGUnKQogICAgICAgICAgICAgICAgLnZhbHVlKCkKICAgICAgICAgICAgZXZlbnRCdXMuJGVtaXQoJ3RyYWNrTWFwVGltZScsIHsKICAgICAgICAgICAgICAgIGRhdGU6IHRpbWVBcnJbaW5kZXhdLAogICAgICAgICAgICAgICAgaXNBZGQ6IHRoaXMuaXNBbGwsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHRoaXMuY3VycmVudERhdGUgPSB0aW1lQXJyW2luZGV4XQogICAgICAgIH0sCiAgICAgICAgaGFuZGxlQWxsQ2hhbmdlKCkgewogICAgICAgICAgICB0aGlzLmluaXRNYXAoKQogICAgICAgIH0sCiAgICB9LAogICAgbW91bnRlZCgpIHsKICAgICAgICB0aGlzLmluaXRIZWF0RGF0YSgpLnRoZW4oKCkgPT4gewogICAgICAgICAgICB0aGlzLm15Q2hhcnQgPSBlY2hhcnRzLmluaXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RyYWNrTWFwJyksICdsaWdodCcpOwogICAgICAgICAgICB0aGlzLmluaXRNYXAoKQogICAgICAgICAgICB0aGlzLmhhbmxlVGltZWxpbmVjaGFuZ2VkKCkKICAgICAgICB9KQogICAgfSwKICAgIGJlZm9yZURlc3Ryb3koKSB7CiAgICAgICAgdGhpcy5teUNoYXJ0LmRpc3Bvc2UoKQogICAgfQp9Cg=="},{"version":3,"sources":["map.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"map.vue","sourceRoot":"src/page/ranking/components","sourcesContent":["<template>\n    <div class=\"lines-map-container\">\n        <div class=\"map-tool\">\n            <el-switch\n                v-model=\"isAll\"\n                active-text=\"男\"\n                inactive-text=\"女\"\n                inactive-color=\"#b2d4f3\"\n                @change=\"handleAllChange\"\n            />\n        </div>\n        <div class=\"map-title\">{{currentDate}}</div>\n        <div id=\"trackMap\">\n\n        </div>\n    </div>\n</template>\n\n<script>\n    import eventBus from '../eventBus';\n    import _ from 'lodash';\n    import { extent } from 'd3'\n    import echarts from 'echarts/lib/echarts';\n    import 'echarts/lib/component/geo'\n    import 'echarts/map/js/world.js';\n    import StationGeo from '@/data/station'\n    import TrackJSON from '@/data/track'\n    import CountryMappingJSON from '@/data/countryMapping'\n    import CountryI18n from '@/data/countryI18n'\n\n    const PERIOD = 2;\n\n    const DEFAULT_CENTER = [114.279, 30]\n\n    const DEFAULT_ZOOM = 9\n\n    export default {\n        name: 'Map',\n        data() {\n            return {\n                isAll: true,\n                currentDate: '',\n            }\n        },\n        methods: {\n            initMap() {\n                const series = this.initSeries();\n                const {options, timelineData} = this.initOptions()\n                var option = {\n                    baseOption: {\n                        timeline: {\n                            currentIndex: this.timelineIndex || 0,\n                            orient: 'vertical',\n                            top: '20',\n                            left: '90%',\n                            right: '20',\n                            bottom: '10',\n                            axisType: 'category',\n                            symbol: 'rect',\n                            symbolSize: [10, 6],\n                            itemStyle: {\n                                color: '#152a68',\n                            },\n                            checkpointStyle: {\n                                symbol: 'roundRect',\n                                color: '#3c8af1',\n                                symbolSize: [10, 6],\n                                borderWidth: 0,\n                            },\n                            controlStyle: {\n                                itemSize: 15,\n                            },\n                            emphasis: {\n                                itemStyle: {\n                                    color: '#3c8af1',\n                                },\n                                label: {\n                                    color: '#3c8af1',\n                                },\n                                controlStyle: {\n                                    color: '#3c8af1',\n                                    borderColor: '3c8af1',\n                                    borderWidth: 2,\n                                },\n                            },\n                            label: {\n                                position: 10,\n                                interval: 1,\n                                color: '#aaa',\n                                fontSize: 10,\n                                formatter: value => {\n                                    const date = new Date(value)\n                                    return [date.getFullYear(),\n                                        date.getMonth() + 1,\n                                        date.getDate()]\n                                            .join('-')\n                                }\n                            },\n                            loop: true,\n                            autoPlay: true,\n                            playInterval: PERIOD * 1000,\n                            data: timelineData\n                        },\n                        tooltip: {\n                            trigger: 'item',\n                            backgroundColor: 'rgba(166, 200, 76, 0.82)',\n                            borderColor: '#FFFFCC',\n                            showDelay: 0,\n                            hideDelay: 0,\n                            enterable: true,\n                            transitionDuration: 0,\n                            extraCssText: 'z-index:100',\n                        },\n                        visualMap: [\n                        {\n                            id: 'heatmap',\n                            show: true,\n                            seriesIndex: 5,\n                            min: 0,\n                            max: 10000,\n                            left: 10,\n                            itemGap: 4,\n                            itemSymbol: 'circle',\n                            textStyle: {\n                                color: '#aaa',\n                            },\n                            pieces: [{\n                                gt: 10000,\n                                label: \"> 10000 人\",\n                                color: \"rgba(57, 111, 255)\"\n                            }, {\n                                gte: 5000,\n                                lte: 10000,\n                                label: \"5000 - 10000 人\",\n                                color: \"rgba(50, 97, 222)\"\n                            }, {\n                                gte: 200,\n                                lt: 5000,\n                                label: \"200 - 5000 人\",\n                                color: \"rgba(42, 82, 189)\"\n                            }, {\n                                gt: 0,\n                                lt: 200,\n                                label: \"0 - 200人\",\n                                color: \"rgba(35, 68, 156)\"\n                            }, {\n                                value: 0,\n                                color: \"rgba(51, 69, 89, .5)\"\n                            }],\n                        }],\n                        geo: {\n                            map: 'world',\n                            zoom: DEFAULT_ZOOM,\n                            center: DEFAULT_CENTER,\n                            label: {\n                                emphasis: {\n                                    show: false\n                                }\n                            },\n                            scaleLimit: {\n                                min: 1,\n                                max: 12\n                            },\n                            roam: true, //是否允许缩放\n                            itemStyle: {\n                                normal: {\n                                    color: 'rgba(51, 69, 89, .5)', //地图背景色\n                                    borderColor: '#516a89', //省市边界线00fcff 516a89\n                                    borderWidth: 1\n                                },\n                                emphasis: {\n                                    color: 'rgba(51, 69, 89, .5)' //悬浮背景\n                                }\n                            }\n                        },\n                        series: series\n                    },\n                    options,\n                };\n                this.myChart.setOption(option, true);\n            },\n            initHeatData() {\n                return fetch('d/format_timeseries.json')\n                    .then(res => res.json())\n                    .then(res => {\n                        this.heatData = _.pickBy(res, (d, k) => CountryMappingJSON[k])\n                    })\n            },\n            initData() {\n                const trackObj = _.chain(TrackJSON)\n                    .filter(d => d.track.length > 0)\n                    .map(d => {\n                        const { track, blh } = d;\n                        const startstation = track[0];\n                        const endstation = track[track.length - 1];\n                        const trackItem = [{\n                            name: startstation.from,\n                            time: startstation.time,\n                            value: 1,\n                            coord: StationGeo[startstation.from],\n                        }, {\n                            name: endstation.to,\n                            time: endstation.time,\n                            value: 1,\n                            coord: StationGeo[endstation.to],\n                        }]\n                        return {\n                            blh,\n                            track: trackItem,\n                        }\n                    })\n                    .reduce((o, d) => {\n                        const key = d.track[1].time\n                        if (o[key]) {\n                            o[key].push(d)\n                        } else {\n                            o[key] = [d]\n                        }\n                        return o\n                    }, {})\n                    .pickBy('length')\n                    .value()\n                return trackObj;\n            },\n            getScatterData(data) {\n                return _.chain(data)\n                    .flattenDeep()\n                    .reduce((obj, d) => {\n                        if(d.name === '深圳') return obj;\n                        if (!obj[d.name]) {\n                            obj[d.name] = {\n                                name: d.name,\n                                value: d.coord.concat(0),\n                            }\n                        }\n                        obj[d.name].value[2] += 1\n                        return obj;\n                    }, {})\n                    .values()\n                    .value();\n            },\n            getHeatData(date) {\n                return _.chain(this.heatData)\n                    .map((arr, k) => {\n                        const findItem = arr.find(d1 => d1.date === date) || {}\n                        return {\n                            name: CountryMappingJSON[k],\n                            value: findItem.exist || 0\n                        }\n                    })\n                    .value()\n            },\n            initOptions() {\n                const timeTrack = this.initData()\n                this.timeTrack = timeTrack\n                const options = _.chain(timeTrack)\n                    .orderBy(d => new Date(d[0].track[1].time).getTime())\n                    .map((d, i, arr) => {\n                        const trackData = d.map(d1 => d1.track)\n                        const addTrackData = this.isAll\n                        ? _.chain(arr)\n                            .slice(0, i + 1)\n                            .flatten()\n                            .map(d1 => d1.track)\n                            .value()\n                        : []\n                        const scatterData = this.getScatterData(trackData)\n                        const addScatterData = this.getScatterData(addTrackData)\n                        \n                        const newDate = new Date(d[0].track[1].time)\n                        const currentDate = `${newDate.getFullYear()}-${\n                            newDate.getMonth() + 1}-${newDate.getDate()}`\n                        const heatData = this.getHeatData(currentDate)\n                        return {\n                            series: [{\n                                data: trackData,\n                            },\n                            {\n                                data: scatterData,\n                            },\n                            {\n                                data: addTrackData,\n                            },\n                            {\n                                data: addScatterData\n                            },\n                            {},\n                            {\n                                data: heatData\n                            }]\n                        }\n                    })\n                    .value()\n\n                const timelineData = _.chain(timeTrack)\n                    .keys()\n                    .orderBy(d => new Date(d).getTime())\n                    .value()\n                return {options, timelineData}\n            },\n            calculateRadius(d) {\n                if(d[2] >= 10) {\n                    return 10\n                } else if(d[2]<=4){\n                    return 4;\n                }\n                return d[2] \n            },\n            initSeries() {\n                const series = [];\n                series.push(\n                    {\n                        type: \"lines\",\n                        zlevel: 2,\n                        effect: {\n                            show: true,\n                            period: PERIOD - .5, //箭头指向速度，值越小速度越快\n                            trailLength: 0.02, //特效尾迹长度[0,1]值越大，尾迹越长重\n                            symbol: \"arrow\", //箭头图标\n                            symbolSize: 5, //图标大小\n                            loop: false,\n                        },\n                        lineStyle: {\n                            width: 1, //尾迹线条宽度\n                            opacity: 0.4, //尾迹线条透明度\n                            curveness: 0.3, //尾迹线条曲直度\n                            color: '#fe7335',\n                        },\n                    },\n                    {\n                        type: 'effectScatter',\n                        coordinateSystem: 'geo',\n                        zlevel: 1,\n                        rippleEffect: { //涟漪特效\n                            period: 4, //动画时间，值越小速度越快\n                            brushType: 'stroke', //波纹绘制方式 stroke, fill\n                            scale: 4 //波纹圆环最大限制，值越大波纹越大\n                        },\n                        label: {\n                            normal: {\n                                show: true,\n                                position: 'right', //显示位置\n                                offset: [5, 0], //偏移设置\n                                formatter: function(params){//圆环显示文字\n                                    return params.data.name;\n                                },\n                                fontSize: 10\n                            },\n                            emphasis: {\n                                show: true\n                            }\n                        },\n                        symbol: 'circle',\n                        symbolSize: d => this.calculateRadius(d),\n                        itemStyle: {\n                            color: '#fe7335',\n                        },\n                    },\n                    {\n                        id: 'allLines',\n                        type: \"lines\",\n                        zlevel: 2,\n                        lineStyle: {\n                            color: '#fe7335',\n                            width: 1, //尾迹线条宽度\n                            opacity: 0.8, //尾迹线条透明度\n                            curveness: 0.3 //尾迹线条曲直度\n                        },\n                        animation: false,\n                    },\n                    {\n                        id: 'addScatter',\n                        type: 'scatter',\n                        coordinateSystem: 'geo',\n                        zlevel: 1,\n                        label: {\n                            show: false,\n                        },\n                        symbol: 'circle',\n                        symbolSize: d => this.calculateRadius(d),\n                        itemStyle: {\n                            color: '#fe7335',\n                            opacity: .8,\n                        },\n                        animation: false,\n                    },\n                    {\n                        type: 'scatter',\n                        coordinateSystem: 'geo',\n                        zlevel: 2,\n                        rippleEffect: {\n                            period: 4,\n                            brushType: 'stroke',\n                            scale: 4\n                        },\n                        label: {\n                            normal: {\n                                show: true,\n                                position: 'right',\n                                //offset:[5, 0],\n                                color: '#1cf3e8',\n                                formatter: '{b}',\n                                textStyle: {\n                                    color: \"#1cf3e8\"\n                                }\n                            },\n                            emphasis: {\n                                show: true,\n                                color: \"#f60\"\n                            }\n                        },\n                        symbol: 'pin',\n                        symbolSize: 20,\n                        z: 10,\n                        data: [{\n                            name: '深圳',\n                            value: StationGeo['深圳'].concat([10]),\n                        }],\n                    },\n                    {\n                        type: 'map',\n                        geoIndex: 0,\n                        tooltip: {\n                            show: true,\n                            formatter: ({data}) => {\n                                const name = CountryI18n[data.name] ? CountryI18n[data.name] : data.name\n                                const value = isNaN(data.value) || !data.value ? 0 : data.value\n                                let str = `${this.currentDate}<br/>${name}: ${value}  例`\n                                if (!data.name) str = null\n                                return str\n                            }\n                        },\n                    }\n                );\n                return series;\n            },\n            hanleTimelinechanged() {\n                this.updateDate(0)\n                this.myChart.on('timelinechanged', ({ currentIndex }) => {\n                    this.timelineIndex = currentIndex\n                    const { series } = this.myChart.getOption()\n                    const seriesIndex = this.isAll ? 3 : 1\n                    const geoArr = _.chain(series[seriesIndex].data)\n                        .map(d => d.value.slice(0, 2))\n                        .value()\n                    geoArr.push(StationGeo[\"深圳\"])\n                    const lngExtent = extent(geoArr, d => +d[0]).map((d, i) => +d + (i === 0 ? (-1) : 1))\n                    const latExtent = extent(geoArr, d => +d[1]).map((d, i) => +d + (i === 0 ? (-10) : 10))\n\n                    const lngCenter = Number.isNaN(lngExtent[0]) ? DEFAULT_CENTER[0] : (lngExtent[0] + lngExtent[1]) / 2\n                    const latCenter = Number.isNaN(latExtent[0]) ? DEFAULT_CENTER[1] : (latExtent[0] + latExtent[1]) / 2\n                    const center = [lngCenter, latCenter]\n                    const zoom = Number.isNaN(lngExtent[0]) ? DEFAULT_ZOOM\n                        : _.min([1 / ((lngExtent[1] - lngExtent[0]) / 360), 1 / ((latExtent[1] - latExtent[0]) / 180)])\n\n                    const heatExtent = extent(series[5].data, d => d.value)\n                    this.myChart.setOption({\n                        geo: {\n                            zoom,\n                            center,\n                        },\n                        visualMap: {\n                            id: 'heatmap',\n                            min: heatExtent[0] + 1,\n                            max: heatExtent[1] + heatExtent[1] * .2\n                        },\n                        series: {\n                            id: 'allLines',\n                            lineStyle: {\n                                opacity: '.2',\n                            },\n                        }\n                    }, this)\n\n                    this.updateDate(currentIndex)\n                })\n            },\n            updateDate(index) {\n                const timeArr = _.chain(this.timeTrack)\n                    .map((d, k) => ({\n                        date: k,\n                        time: new Date(k).getTime(),\n                    }))\n                    .orderBy('time')\n                    .map('date')\n                    .value()\n                eventBus.$emit('trackMapTime', {\n                    date: timeArr[index],\n                    isAdd: this.isAll,\n                })\n                this.currentDate = timeArr[index]\n            },\n            handleAllChange() {\n                this.initMap()\n            },\n        },\n        mounted() {\n            this.initHeatData().then(() => {\n                this.myChart = echarts.init(document.getElementById('trackMap'), 'light');\n                this.initMap()\n                this.hanleTimelinechanged()\n            })\n        },\n        beforeDestroy() {\n            this.myChart.dispose()\n        }\n    }\n</script>\n\n<style lang=\"less\">\n   .el-switch__label{\n        color: #aaa;\n    }\n    .lines-map-container {\n        position: relative;\n        padding: 0;\n        margin: 0;\n        width: 100%;\n        .map-tool {\n            position: absolute;\n            top: 5px;\n            z-index: 2;\n            transform: scale(.8);\n        }\n        .map-title {\n            position: absolute;\n            top: 10px;\n            right: 100px;\n            z-index: 2;\n            color: white;\n            font-size: 32px;\n            text-shadow: 3px 3px black, -2px -2px black, 2px -2px black,\n        }\n        #trackMap{\n            width: 100%;\n            height: 100%;\n        }\n    }\n</style>"]}]}