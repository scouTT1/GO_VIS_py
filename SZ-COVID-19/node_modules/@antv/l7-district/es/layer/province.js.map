{"version":3,"sources":["../../src/layer/province.ts"],"names":["merge","getDataConfig","BaseLayer","ProvinceLayer","scene","option","fillRawData","lineRawData","labelRawData","addProvinceFillLayer","adcode","newData","joinByField","Array","isArray","length","hide","setOption","fillData","filterData","lineData","labelData","filterLabelData","options","bubble","enable","bubbleData","features","map","feature","properties","center","x","y","bubbleLayer","setData","updateData","lineLayer","labelLayer","show","config","depth","label","field","textAllowOverlap","popup","Html","props","NAME_CHN","data","adcodeArray","filter","fe","code","adcode_pro","indexOf","type","countryConfig","geoDataLevel","country","CHN","fetchData","fill","addFillLayer","addLabelLayer","addFillLine","line"],"mappings":"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","sourcesContent":["import {\n  ILayer,\n  LineLayer,\n  PointLayer,\n  PolygonLayer,\n  Scene,\n  StyleAttrField,\n} from '@antv/l7';\n// tslint:disable-next-line: no-submodule-imports\nimport merge from 'lodash/merge';\nimport { getDataConfig } from '../';\nimport BaseLayer from './baseLayer';\nimport { adcodeType, IDistrictLayerOption } from './interface';\n\nexport interface IProvinceLayerOption extends IDistrictLayerOption {\n  adcode: adcodeType;\n}\nexport default class ProvinceLayer extends BaseLayer {\n  private fillRawData: any;\n  private lineRawData: any;\n  private labelRawData: any;\n  constructor(scene: Scene, option: Partial<IProvinceLayerOption> = {}) {\n    super(scene, option);\n    this.addProvinceFillLayer();\n    // this.addProvinceLineLayer();\n  }\n  // 通过adcode 更新\n  public updateDistrict(\n    adcode: adcodeType,\n    newData: Array<{ [key: string]: any }> = [],\n    joinByField?: [string, string],\n  ) {\n    if (!adcode && Array.isArray(adcode) && adcode.length === 0) {\n      this.hide();\n      return;\n    }\n    this.setOption({ adcode });\n    const fillData = this.filterData(this.fillRawData, adcode);\n    const lineData = this.filterData(this.lineRawData, adcode);\n    const labelData = this.filterLabelData(this.labelRawData, adcode);\n    if (this.options.bubble && this.options.bubble?.enable !== false) {\n      const bubbleData = fillData.features.map((feature: any) => {\n        return {\n          ...feature.properties,\n          center: [feature.properties.x, feature.properties.y],\n        };\n      });\n      this.bubbleLayer.setData(bubbleData);\n    }\n    this.fillData = fillData;\n    this.updateData(newData, joinByField);\n    this.lineLayer.setData(lineData);\n    this.labelLayer.setData(labelData);\n    this.show();\n  }\n\n  protected getDefaultOption(): IProvinceLayerOption {\n    const config = super.getDefaultOption();\n    return merge({}, config, {\n      adcode: ['110000'],\n      depth: 2,\n      label: {\n        field: 'NAME_CHN',\n        textAllowOverlap: false,\n      },\n      popup: {\n        enable: true,\n        Html: (props: any) => {\n          return `<span>${props.NAME_CHN}</span>`;\n        },\n      },\n    });\n  }\n\n  protected filterData(data: any, adcode: adcodeType) {\n    const adcodeArray = Array.isArray(adcode) ? adcode : [adcode];\n    const features = data.features.filter((fe: any) => {\n      const code = fe.properties.adcode_pro;\n      return (\n        adcodeArray.indexOf(code) !== -1 ||\n        adcodeArray.indexOf('' + code) !== -1\n      );\n    });\n    return { type: 'FeatureCollection', features };\n  }\n\n  protected filterLabelData(data: any, adcode: adcodeType) {\n    const adcodeArray = Array.isArray(adcode) ? adcode : [adcode];\n    const features = data.filter((fe: any) => {\n      const code = fe.adcode_pro;\n      return (\n        adcodeArray.indexOf(code) !== -1 ||\n        adcodeArray.indexOf('' + code) !== -1\n      );\n    });\n    return features;\n  }\n  private async addProvinceFillLayer() {\n    const { depth, adcode } = this.options as IProvinceLayerOption;\n    const countryConfig = getDataConfig(this.options.geoDataLevel).country.CHN[\n      depth\n    ];\n    const fillData = await this.fetchData(countryConfig.fill);\n\n    this.labelRawData = fillData.features.map((feature: any) => {\n      return {\n        ...feature.properties,\n        center: [feature.properties.x, feature.properties.y],\n      };\n    });\n    const data = this.filterData(fillData, adcode);\n    const labelData = this.filterLabelData(this.labelRawData, adcode);\n    this.fillRawData = fillData;\n    this.addFillLayer(data);\n    this.addLabelLayer(labelData);\n    this.lineRawData = fillData;\n    this.addFillLine(data);\n  }\n\n  private async addProvinceLineLayer() {\n    const { depth, adcode } = this.options as IProvinceLayerOption;\n    const countryConfig = getDataConfig(this.options.geoDataLevel).country.CHN[\n      depth\n    ];\n    const fillData = await this.fetchData(countryConfig.line);\n    const data = this.filterData(fillData, adcode);\n    this.lineRawData = fillData;\n    this.addFillLine(data);\n  }\n}\n"],"file":"province.js"}